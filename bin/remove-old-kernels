#!/bin/bash
#
# Remove old Ubuntu Kernels
#
# Copyright (c) 2013 Flaud√≠sio Tolentino
#
##

ProgramName="Remove old Ubuntu Kernels"
ProgramVersion="0.1.1"

OldKernels="$(
    dpkg -l \
        | egrep -i 'linux-(image(-extra)?|headers)-[0-9]+' \
        | fgrep -v -- "$( uname -r | egrep -o '\-[0-9]{2}' )" \
        | awk '{ print $2 }'
)"

echo -e "\n$ProgramName v${ProgramVersion}\n"

echo -e "Current Kernel: $( uname -r )\n"

if [ -z "$OldKernels" ] ; then
    echo "I have not fond any additional kernels installed on this system."
else
    echo "I've found the following kernels:"
    echo -e "\n$OldKernels\n"

    read -p "Do you want to REMOVE them? (y/N) " option

    case "${option:-}" in
        [Yy]es|[Yy]|[Ss]im|[Ss]|1|[Tt]rue|[Tt])
            echo -e "\nRunning aptitude purge...\n"
            sudo aptitude purge $OldKernels -P
        ;;
        *)
            echo -e "\nAborting."
        ;;
    esac
fi

echo

exit 0
